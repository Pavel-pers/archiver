# Defer

В компании Google однажды придумали язык Go.
Go славится своей простотой, которая при дизайне языка была поставлена во главу угла.
Из-за этого местами язык не слишком красивый и достаточно многословный.
Однако, и в нем есть интересные конструкции.
Одной из самых необычных для разработчиков на C++ явно можно считать `defer`.

Как работает `defer` ? Это приблизительный аналог деструкторам в C++. Данное ключевое слово позволяет выполнить какой-то регион кода не сразу по месту написания, а в тот момент, как исполнение покинет текущую функцию. Таким образом, через `defer` принято очищать ресурсы. Например, открытие файла в Go типично выглядит так:

```go
file, err := os.Open("path.txt")
if err != nil {
    return err
}
defer file.Close()

// Use file
```

## Что нужно сделать?
Напишите аналог `defer` в C++ с одним важным отличием: `defer` будет выполняться в конце текущего scope, а не в конце всей функции. 

## Как это сделать?
Придется изучить пару концепций, которые мы не рассматривали на лекциях.
`defer` предлагается сделать макросом.
Макрос получится достаточно нетривиальный из-за необходимости генерировать уникальные имена переменных.
Почитайте про использование макросов, например, на [cppreference](https://en.cppreference.com/w/cpp/preprocessor/replace).

Кроме того, вам, скорее всего, захочется сохранить лямбда-функцию полем класса. Это можно сделать, объявив класс шаблоном. В качестве более простой альтернативы в данной задаче можно использовать `std::function`.
